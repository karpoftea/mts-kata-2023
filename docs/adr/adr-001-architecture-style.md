# Title
Выбор шаблонов и стилей интеграции

# Status
Proposed

# Context
Для системы:
-  состоящей из разнородных модулей, с отличающимися друг от друга многими свойствами (назначением, режимом использования, технологией реализиции и пр.),
-  взаимодействующей с внешними системами, а также
-  развивающейся поэтапно,

требуется определить шаблоны и стили интеграции.

## 2.1. Drivers
Факторы, влияющие на решение:
1. В момент проведения воркшопа для гостей (онлайн-хакатон, всероссийский тотальный диктант и т. д.), либо при запуске нового востребованного курса, гости \ студенты будут обращаться к системе (почти) одновременно, а также будут ждать одновременной работы с ними преподавателей.
2. При проверке заданий по конкурсам или итоговых работ по курсу, гости \ студенты действуют не согласованно.

## 2.2. Problem
Повышенная нагрузка на систему в моменты проведения воркшопов или новых курсов может привести к потере части обращений, если система не будет справляться с их обработкой в такие моменты времени.

## 2.3. Options
### 2.3.1. По структуре связи:
Шаблоны интеграционного взаимодействия по структуре связи:
- Точка-точка, посредством прямого вызова модулей друг друга, используемой в случае, если число модулей невелико, и они не могут быть унифицированы (или в этом нет смысла).
- Звезда, посредством только интегрирующей среды взаимодействия, реализующий универсальный интерфейс для доступа всех модулей.
- Смешанное, посредством единой шины и прямого вызова.

### 2.3.2. По классификации API\BUS\API Gateway
Шаблоны интеграционного взаимодействия по классификации API\BUS\API Gateway:
- Посредством API, напрямую между модулями.
- Посредством BUS - единой шины, используемой при подключении большого числа модулей или внешних систем с типовыми структурами и событиями.
- Посредством API Gateway - шлюза, когда внутри запросов требуюется обеспечить доступ к данным, бизнес‑логике или функциональным возможностям одновременно нескольких модулей.

### 2.3.3. По связности:
Шаблоны интеграционного взаимодействия по связности:
- Синхронное, когда требуется немедленный ответ на запрос.
- Асинхронное, когда ответ на запрос допукскается выдать через некоторое время.

### 2.3.4. По протоколу:
Шаблоны интеграционного взаимодействия по протоколу:
- REST, который
  - широко распространен,
  - легко запускается и отлаживается,
  - не фиксирует схему данных,
  - используется при синхронном взаимодействии.
- GraphQL, который
  - предоставляет возможность вызова нескольких взаимосвязанных функций в рамках одного запроса,
  - фиксирует схему данных,
  - может работать с более сложными структурами, чем REST,
  - может использоваться при асинхронном и синхронном взаимодействии.
- gRPC, который
  - фиксирует схему данных,
  - имеет высокую производительность,
  - требует настройку отдельного клиента и сервиса,
  - более сложный в использовании, чем REST.

# Decision
## 3.1. Описание выбранного решения 
Мы будем использовать следующие шаблоны:
- По структуре связи:
  - Точка-точка, так как унификация разнородных модулей не целесообразна.

- По классификации API\BUS\API Gateway:
  - Частично посредством API, так как:
    - некоторые модули имеют разные структуры данных, используются в определенном случае (старая система Поколение-М, система уведомлений МТС, Webinar, WASD, Корпоративный университет МТС),
    - проще обеспечить тестируемость и легкость доработки.
  - Посредством API Gateway, так как
    - при получении запросов от разных интерфейсов пользователя (ЛК студента, ЛК персонала), либо увеличении числа сервисов после MVP, клиентские запросы должны (будут) использовать данные нескольких сервисов.

- По связности:
  - Синхронное в процессе проедения воркшопа \ нового востребованного курса, где гости \ студенты будут обращаться к системе (почти) одновременно, а преподаватели с ними должны взаимодействовать в режиме realtime, и на этом участке требуется высокая согласованность данных.

  - Асинхронное проверке заданий по конкурсам или итоговых работ по курсу, так как пользователи с ролями "Докладчик" и "Рецензент" действуют не синхронно, так как этот формат активности предполагает наличие некоторого периода времени (дни, недели), когда работы будут поступать, а затем проверяться.

- По протоколу:
  - JSON-RPC (может быть где-то проще или используется в нужных нам компонентах?)
  - FTP (нужна стрелка в наше новое хранилище?)
  - REST в формате JSON, так как он отлично подходит для работы с простыми структурами данных (элементы образовательной программы, расписание, данные о пользователях).

## 3.2. Схема решения 
```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

LAYOUT_WITH_LEGEND()

title Диаграмма

Person(student, "Обучающийся", "Гость или Студент системы")
Person(staff, "Персонал", "Преподаватель, СотрудникПоддержки или Администратор системы")

System(studentGUI, "GUI для обучающихся", "Регистрация и просмотр курсов и участие в воркшопах")
System(staffGUI, "GUI для персонала", "Добавление курсов, проведение занятий, проверка заданий")


Rel(student, studentGUI, "REST")
Rel(staff, staffGUI, "REST")

System(apigw, "API Gateway", "Прием запросов с графического интерфейса")

Rel(studentGUI, apigw, "REST")
Rel(staffGUI, apigw, "REST")

System(auth, "Учет пользователй", "Аутентификация и регистрация новых пользователей")

Rel(apigw, auth, "REST")

System(content, "Учет курсов, материалов и проведение занятий", "Учет элементов образовательных программ, материалов, ведение справочников и проведение занятий")

Rel(apigw, content, "REST")

System(video, "Хранение видео-контента", "Хранение видео-контента")

Rel(apigw, video, "?")

System_Ext(emailsys, "Система уведомлений МТС", "Коммунальный сервер МТС для рассылок")
System_Ext(webinar, "Webinar", "Система проведения онлайн мероприятий")
System_Ext(legacy, "Старая система Поколение-М", "Информационный портал с неструктурированными материалами")
System_Ext(mtsa, "МТС Аналитика", "Анализ статистики поведения и заинтересованности аудитории")

Rel(content, emailsys, "REST")
Rel(apigw, webinar, "REST")
Rel(content, legacy, "JDBC, FTP")
Rel(content, mtsa, "REST")

@enduml
```

## 3.3. Фактор принятия решения

### Шаблон взаимодействия Точка-точка
- обоснован, так как использовать универсальный интерфейс для подключения рассматриваемых модулей не целесообразно.

### Шаблон взаимодействия по API\API Gateway
- выбраны, так как использовать единую шину в нашей системе не целесообразно из-за:
  - разнородности модулей (авторизация, учет контента, уведомления), а также
  - необходимости использования временных компонентов для миграции данных из старой системы,
  - потребности одновременного использования и перехода с одних имеющихся средств для хранения видео \ трансляции на целевые (WASD).

### Способы Синхронного\Асинхронного взаимодействия
- целесообразно применять каждый на своем участке, где: а) требуется обеспечить выполнение свойств согласованности (синхронное взаимодействие), либо б) предполагается асинхронное взаимодействие исходя из логики предметной области.

### Протокол REST
- неиболее соответствует невысокому уровню сложности задачи, в то время как протоколы gRPC, GraphQL применимы в задачах более высокой сложности, и требуют соответсвующих ресурсов на их использование и поддержку в случае доработки.

При выработке решения учтены требования к разработке и внедрению функционала (НФТ: НФТ.003, НФТ.004, НФТ.005, НФТ.006, НФТ.012 и НФТ.016 соответственно):
- Нагрузка с различными материалами \ с одним материалом
- Доступность \ стабильность
- elasticity
- Тестируемость \ легкость доработки